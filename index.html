<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Prompt Generator - Prompter</title>
    <link rel="icon" type="image/svg+xml" href="icons/logo.svg">
<script>
  (function() {
    function addScript(src) {
      const s = document.createElement('script');
      s.src = src;
      s.async = true;
      document.head.appendChild(s);
      return s;
    }

    function fetchWithTimeout(url, timeout = 500) {
      return Promise.race([
        fetch(url, { method: 'HEAD', mode: 'no-cors' }),
        new Promise((_, reject) => setTimeout(() => reject(new Error('timeout')), timeout))
      ]);
    }

    function loadWithFallback(primary, local) {
      let cdnScript = null;
      let localScript = null;

      const addLocal = () => {
        localScript = document.createElement('script');
        localScript.src = local;
        localScript.async = true;
        document.head.appendChild(localScript);
      };

      // If offline, load local immediately
      if (!navigator.onLine) {
        addLocal();
        return { cdn: null, local: localScript };
      }

      // Online: Try CDN with fallback
      let fallbackTimer = null;

      // Set up fallback timer (500ms to quickly load local icons if CDN is slow)
      fallbackTimer = setTimeout(() => {
        addLocal();
        fallbackTimer = null;
      }, 500);

      // Try to fetch from CDN first
      fetchWithTimeout(primary).catch(() => {
        if (fallbackTimer) {
          clearTimeout(fallbackTimer);
          fallbackTimer = null;
        }
        addLocal();
      });

      // Add CDN script
      cdnScript = addScript(primary);

      // Handle CDN script events
      cdnScript.onload = () => {
        if (fallbackTimer) {
          clearTimeout(fallbackTimer);
          fallbackTimer = null;
        }
      };

      cdnScript.onerror = () => {
        if (fallbackTimer) {
          clearTimeout(fallbackTimer);
          fallbackTimer = null;
        }
        addLocal();
      };

      return { cdn: cdnScript, local: localScript };
    }

    loadWithFallback('https://cdn.tailwindcss.com', 'tailwind.js');
    window.lucideScripts = loadWithFallback('https://unpkg.com/lucide@latest/dist/umd/lucide.min.js', 'lucide.min.js');
  })();
</script>
    <style>
        /* Custom styles */
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .bg-gradient-to-br {
            background-image: linear-gradient(to bottom right, var(--tw-gradient-stops));
        }
        .from-purple-900 { --tw-gradient-from: #581c87; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(88, 28, 135, 0)); }
        .via-blue-900 { --tw-gradient-stops: var(--tw-gradient-from), #1e3a8a, var(--tw-gradient-to, rgba(30, 58, 138, 0)); }
        .to-indigo-900 { --tw-gradient-to: #312e81; }
        .bg-gradient-to-r { background-image: linear-gradient(to right, var(--tw-gradient-stops)); }
        .from-cyan-400 { --tw-gradient-from: #22d3ee; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(34, 211, 238, 0)); }
        .to-purple-400 { --tw-gradient-to: #c084fc; }
        .from-purple-500 { --tw-gradient-from: #a855f7; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(168, 85, 247, 0)); }
        .to-pink-500 { --tw-gradient-to: #ec4899; }
        .from-cyan-500 { --tw-gradient-from: #06b6d4; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(6, 182, 212, 0)); }
        .to-purple-500 { --tw-gradient-to: #a855f7; }
        .hover\:from-cyan-600:hover { --tw-gradient-from: #0891b2; }
        .hover\:to-purple-600:hover { --tw-gradient-to: #9333ea; }
        .bg-clip-text { background-clip: text; -webkit-background-clip: text; }
        .text-transparent { color: transparent; }
        .backdrop-blur-md { backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
        .selection\:bg-purple-500::selection { background-color: #a855f7; }
        .selection\:text-white::selection { color: white; }
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
          animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes spin {
          to { transform: rotate(360deg); }
        }
        .animate-spin {
          animation: spin 1s linear infinite;
        }
        @keyframes pulse {
          50% { opacity: .5; }
        }
        .animate-pulse {
          animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .lucide {
            width: 1em;
            height: 1em;
            stroke-width: 2;
            stroke: currentColor;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .category-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            border-radius: 0.75rem;
            text-align: center;
            transition: all 0.2s ease-in-out;
            height: 5rem;
            background-color: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .category-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        .category-button.selected {
            background-image: linear-gradient(to right, var(--tw-gradient-stops));
            --tw-gradient-from: #a855f7;
            --tw-gradient-to: #ec4899;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transform: scale(1.05);
            --tw-ring-color: #f472b6;
            box-shadow: 0 0 0 2px var(--tw-ring-color);
        }
        .category-button .lucide {
            width: 1.5rem;
            height: 1.5rem;
            margin-bottom: 0.25rem;
            display: none;
        }
        .emoji-icon {
            font-size: 1.5rem;
            display: inline-block;
            color: currentColor;
        }
        .category-button .emoji-icon {
            width: 1.5rem;
            height: 1.5rem;
            margin-bottom: 0.25rem;
        }
        .category-button span {
            font-size: 0.75rem;
            font-weight: 500;
            line-height: 1.1;
        }
        /* Theme Toggle Styles */
        .theme-toggle-container button {
            transition: background-color 0.2s ease, color 0.2s ease;
        }
    </style>
    <style id="theme-styles">
        /* Default Dark Theme Styles (will be overridden by JS) */
        body {
            background-image: linear-gradient(to bottom right, #581c87, #1e3a8a, #312e81) !important;
            color: white !important;
        }
        .bg-white\/10 {
            background-color: rgba(255, 255, 255, 0.1) !important;
        }
        .bg-black\/30 {
            background-color: rgba(0, 0, 0, 0.3) !important;
        }
        .text-blue-200 {
            color: #bfdbfe !important; /* Tailwind blue-200 */
        }
        .text-blue-300 {
            color: #93c5fd !important; /* Tailwind blue-300 */
        }
        .border-white\/20 {
             border-color: rgba(255, 255, 255, 0.2) !important;
        }
        .bg-black\/20 {
             background-color: rgba(0, 0, 0, 0.2) !important;
        }
        .hover\:bg-white\/10:hover {
             background-color: rgba(255, 255, 255, 0.1) !important;
        }
        .bg-white\/30 {
             background-color: rgba(255, 255, 255, 0.3) !important;
        }
        .hover\:bg-white\/30:hover {
             background-color: rgba(255, 255, 255, 0.3) !important;
        }
        .focus\:ring-white\/50:focus {
             --tw-ring-color: rgba(255, 255, 255, 0.5) !important;
        }
        .category-button {
            background-color: rgba(255, 255, 255, 0.2) !important;
            color: white !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
        }
        .category-button:hover {
            background-color: rgba(255, 255, 255, 0.3) !important;
        }
        .category-button.selected {
            background-image: linear-gradient(to right, #a855f7, #ec4899) !important;
            color: white !important;
        }
        .category-button .lucide {
            color: white !important;
            display: none;
        }
        #app-title {
            background-image: linear-gradient(to right, #22d3ee, #c084fc) !important;
            line-height: 1.3;
            padding-bottom: 5px;
        }
        #choose-style-title, #your-prompt-title {
            color: white !important;
        }
        #lang-en, #lang-tr {
            color: #bfdbfe !important; /* text-blue-200 */
        }
        #lang-en.active, #lang-tr.active {
            background-color: rgba(255, 255, 255, 0.3) !important;
            color: white !important;
        }
        .theme-toggle-container i {
            color: #bfdbfe !important; /* text-blue-200 */
        }
    </style>
</head>
<body class="min-h-screen p-4">

    <div id="app-container" class="max-w-6xl mx-auto relative">
        <!-- Theme Toggle -->
        <div class="theme-toggle-container absolute top-4 left-4 flex items-center gap-2 bg-black/20 backdrop-blur-sm p-1 rounded-lg border border-white/20 z-10">
            <button id="theme-light" class="p-1.5 rounded-md text-sm font-medium" title="Light Theme" aria-label="Light Theme">
              <i data-lucide="sun" class="w-5 h-5" aria-hidden="true"></i>
            </button>
            <button id="theme-dark" class="p-1.5 rounded-md text-sm font-medium" title="Dark Theme" aria-label="Dark Theme">
              <i data-lucide="moon" class="w-5 h-5" aria-hidden="true"></i>
            </button>
        </div>

        <!-- Language Switcher -->
        <div class="absolute top-4 right-4 flex items-center gap-2 bg-black/20 backdrop-blur-sm p-1 rounded-lg border border-white/20 z-10">
           <i data-lucide="languages" class="w-5 h-5 text-blue-300 ml-1" aria-hidden="true"></i>
           <button id="lang-en" class="px-3 py-1 rounded-md text-sm font-medium">
             EN
           </button>
           <button id="lang-tr" class="px-3 py-1 rounded-md text-sm font-medium">
             TR
           </button>
        </div>

        <!-- Header -->
        <div class="text-center mb-6 pt-16 md:pt-12">
          <h1 id="app-title" class="text-4xl md:text-5xl font-bold mb-2 bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent">
            AI Prompt Generator - Prompter
          </h1>
          <p id="app-subtitle" class="text-blue-200 text-lg md:text-xl px-2">
            Prompt generator for AI - unprecedented, limitless creativity
          </p>
        </div>

        <!-- Category Selection -->
        <div class="bg-white/10 backdrop-blur-md rounded-2xl p-4 mb-4 border border-white/20 shadow-lg">
          <h2 id="choose-style-title" class="text-lg font-semibold mb-3">
            Select Your Prompt Inspiration
          </h2>
          <div id="category-buttons" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-12 gap-2">
            <!-- Category buttons load here -->
          </div>
        </div>

        <!-- Generate Button -->
        <div class="text-center mb-4">
          <button id="generate-button" class="bg-gradient-to-r from-cyan-500 to-purple-500 hover:from-cyan-600 hover:to-purple-600 disabled:opacity-50 disabled:cursor-not-allowed font-bold py-3 px-6 rounded-xl text-base transition-all duration-300 ease-in-out transform hover:scale-105 shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-purple-900" aria-label="Generate New Prompt">
            <div class="flex items-center justify-center">
              <i data-lucide="sparkles" class="w-4 h-4 mr-2" aria-hidden="true"></i>
              <span id="generate-button-text">Generate New Prompt</span>
            </div>
          </button>
        </div>

        <!-- Generated Prompt Display -->
        <div id="prompt-display-area" class="hidden bg-white/10 backdrop-blur-md rounded-2xl p-4 border border-white/20 shadow-lg transition-opacity duration-500 ease-in-out">
            <div class="flex justify-between items-center mb-3">
              <h3 id="your-prompt-title" class="text-lg font-semibold">
                Your Unique Prompt:
              </h3>
              <div class="flex gap-2">
                <button id="copy-button" class="p-1.5 rounded-lg bg-white/20 hover:bg-white/30 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-white/50" title="Copy to clipboard" aria-label="Copy to clipboard">
                  <i data-lucide="copy" class="w-4 h-4" aria-hidden="true"></i>
                </button>
                <button id="download-button" class="p-1.5 rounded-lg bg-white/20 hover:bg-white/30 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-white/50" title="Download as .txt" aria-label="Download as .txt">
                  <i data-lucide="download" class="w-4 h-4" aria-hidden="true"></i>
                </button>
              </div>
            </div>
            <div id="generated-prompt-text" class="bg-black/30 rounded-xl p-3 leading-relaxed whitespace-pre-wrap text-base font-mono selection:bg-purple-500 selection:text-white">
              <!-- Generated prompt text loads here -->
            </div>
            <p id="copy-success-message" class="text-green-400 text-sm mt-2 animate-pulse hidden">
              Prompt copied successfully!
            </p>
        </div>

        <!-- Footer/Stats -->
        <div class="mt-8 text-center pb-4">
          <p id="app-stats" class="text-blue-200 text-sm mb-1">
            Prompts that will unlock the potential of your mind
          </p>
          <p id="footer-prompter" class="text-blue-300 text-xs font-semibold">
            Prompter
          </p>
        </div>
    </div>

<script src="prompts.js"></script>
<script>
    // --- Core Application Logic ---
    const appState = {
        generatedPrompt: '',
        selectedCategory: 'random',
        isGenerating: false,
        copySuccess: false,
        language: 'en',
        theme: 'dark', // Default theme
        history: [],        // overall prompt history
        partHistory: [],    // per-part history
        HISTORY_SIZE: 100    // Increased history size
    };

    // --- Utility Functions ---
    const getRandomElement = (array, history = []) => {
        if (!array || array.length === 0) return '';
        const available = array.filter(item => !history.includes(item));
        if (available.length > 0) {
            return available[Math.floor(Math.random() * available.length)];
        }
        return array[Math.floor(Math.random() * array.length)];
    };

    // --- UI Text Translations ---
    const uiText = {
        en: {
            appTitle: "AI Prompt Generator - Prompter",
            appSubtitle: "Prompt generator for AI - unprecedented, limitless creativity",
            chooseStyleTitle: "Select Your Prompt Inspiration",
            generateButtonText: "Generate New Prompt",
            yourPromptTitle: "Your Unique Prompt:",
            copyButtonTitle: "Copy to clipboard",
            downloadButtonTitle: "Download as .txt",
            copySuccessMessage: "Prompt copied successfully!",
            appStats: "Prompts that will unlock the potential of your mind",
            footerPrompter: "Prompter",
            randomCategory: "Random Mix",
            themeLightTitle: "Light Theme",
            themeDarkTitle: "Dark Theme"
        },
        tr: {
            appTitle: "YZ Prompt Üretici - Prompter",
            appSubtitle: "YZ için prompt üretici - eşi benzeri görülmemiş sınırsız yaraticilik",
            chooseStyleTitle: "Prompt İlhamınızı Seçin",
            generateButtonText: "Yeni Prompt Üret",
            yourPromptTitle: "Benzersiz Promptunuz:",
            copyButtonTitle: "Panoya kopyala",
            downloadButtonTitle: ".txt olarak indir",
            copySuccessMessage: "Prompt başarıyla kopyalandı!",
            appStats: "Zihninizin potansiyelini açığa çıkaracak promptlar",
            footerPrompter: "Prompter",
            randomCategory: "Rastgele Karışım",
            themeLightTitle: "Açık Tema",
            themeDarkTitle: "Koyu Tema"
        }
    };

        // --- Category Definitions ---
        const categories = [
            { id: 'random', icon: 'shuffle', emoji: '🔀', name: { en: 'Random Mix', tr: 'Rastgele Karışım' } },
            { id: 'inspiring', icon: 'sunrise', emoji: '🌅', name: { en: 'Inspiring', tr: 'İlham Verici' } },
            { id: 'mindBlowing', icon: 'brain-circuit', emoji: '🤯', name: { en: 'Mind-blowing', tr: 'Ufuk Açıcı' } },
            { id: 'productivity', icon: 'zap', emoji: '⚡', name: { en: 'Productivity', tr: 'Üretkenlik' } },
            { id: 'educational', icon: 'graduation-cap', emoji: '🎓', name: { en: 'Educational', tr: 'Eğitici' } },
            { id: 'crazy', icon: 'laugh', emoji: '😂', name: { en: 'Crazy', tr: 'Çılgın Fikirler' } },
            { id: 'perspective', icon: 'glasses', emoji: '🕶️', name: { en: 'Perspective', tr: 'Bakış Açısı' } },
            { id: 'ai', icon: 'cpu', emoji: '🤖', name: { en: 'AI', tr: 'YZ' } },
            { id: 'ideas', icon: 'lightbulb', emoji: '💡', name: { en: 'Ideas', tr: 'Fikirler' } },
            { id: 'video', icon: 'video', emoji: '🎬', name: { en: 'Video', tr: 'Video' } },
            { id: 'image', icon: 'image', emoji: '🖼️', name: { en: 'Image', tr: 'Görsel' } },
            { id: 'hellprompts', icon: 'skull', emoji: '💀', name: { en: 'Hellprompts', tr: 'Cehennem Promptları' } } // New category
        ];



        // --- DOM Elements ---
        const categoryButtonsContainer = document.getElementById('category-buttons');
        const generateButton = document.getElementById('generate-button');
        const promptDisplayArea = document.getElementById('prompt-display-area');
        const generatedPromptText = document.getElementById('generated-prompt-text');
        const copyButton = document.getElementById('copy-button');
        const downloadButton = document.getElementById('download-button');
        const copySuccessMessage = document.getElementById('copy-success-message');
        const langEnButton = document.getElementById('lang-en');
        const langTrButton = document.getElementById('lang-tr');
        const themeLightButton = document.getElementById('theme-light');
        const themeDarkButton = document.getElementById('theme-dark');
        const themeStyleElement = document.getElementById('theme-styles');

        // --- Theme Toggle Logic ---
        const THEMES = { LIGHT: 'light', DARK: 'dark' };
        const themeStyles = {
            [THEMES.LIGHT]: `
                body { background-image: linear-gradient(to bottom right, #f0f4ff, #d9e2ff, #c4d1ff) !important; color: #1a1a2e !important; }
                .bg-white\/10 { background-color: rgba(255, 255, 255, 0.8) !important; border-color: rgba(0, 0, 0, 0.1) !important; }
                .bg-black\/30 { background-color: rgba(0, 0, 0, 0.05) !important; color: #1e293b !important; }
                .text-blue-200 { color: #4338ca !important; }
                .text-blue-300 { color: #3730a3 !important; }
                .border-white\/20 { border-color: rgba(0, 0, 0, 0.1) !important; }
                .bg-black\/20 { background-color: rgba(0, 0, 0, 0.05) !important; }
                .hover\:bg-white\/10:hover { background-color: rgba(0, 0, 0, 0.1) !important; }
                .bg-white\/30 { background-color: rgba(0, 0, 0, 0.2) !important; }
                .hover\:bg-white\/30:hover { background-color: rgba(0, 0, 0, 0.3) !important; }
                .focus\:ring-white\/50:focus { --tw-ring-color: rgba(0, 0, 0, 0.3) !important; }
                .category-button { background-color: rgba(0, 0, 0, 0.08) !important; color: #1a1a2e !important; border: 1px solid rgba(0, 0, 0, 0.1) !important; }
                .category-button:hover { background-color: rgba(0, 0, 0, 0.15) !important; }
                .category-button.selected { background-image: linear-gradient(to right, #6366f1, #8b5cf6) !important; color: white !important; border-color: transparent !important; }
                .category-button .lucide { color: #4f46e5 !important; display: none; }
                .category-button.selected .lucide { color: white !important; }
                .category-button .emoji-icon { color: #4f46e5 !important; }
                .category-button.selected .emoji-icon { color: white !important; }
                #app-title { background-image: linear-gradient(to right, #4f46e5, #7c3aed) !important; }
                #choose-style-title, #your-prompt-title { color: #1e293b !important; }
                #lang-en, #lang-tr { color: #4338ca !important; }
                #lang-en.active, #lang-tr.active { background-color: rgba(0, 0, 0, 0.2) !important; color: #1e293b !important; }
                .theme-toggle-container i { color: #4338ca !important; }
                .theme-toggle-container button { color: #4338ca !important; }
                .theme-toggle-container button.active { background-color: rgba(0, 0, 0, 0.2) !important; color: #1e293b !important; }
                .absolute.top-4.right-4 i { color: #4338ca !important; }
            `,
            [THEMES.DARK]: `
                body { background-image: linear-gradient(to bottom right, #581c87, #1e3a8a, #312e81) !important; color: white !important; }
                .bg-white\/10 { background-color: rgba(255, 255, 255, 0.1) !important; border-color: rgba(255, 255, 255, 0.2) !important; }
                .bg-black\/30 { background-color: rgba(0, 0, 0, 0.3) !important; color: white !important; }
                .text-blue-200 { color: #bfdbfe !important; }
                .text-blue-300 { color: #93c5fd !important; }
                .border-white\/20 { border-color: rgba(255, 255, 255, 0.2) !important; }
                .bg-black\/20 { background-color: rgba(0, 0, 0, 0.2) !important; }
                .hover\:bg-white\/10:hover { background-color: rgba(255, 255, 255, 0.1) !important; }
                .bg-white\/30 { background-color: rgba(255, 255, 255, 0.3) !important; }
                .hover\:bg-white\/30:hover { background-color: rgba(255, 255, 255, 0.3) !important; }
                .focus\:ring-white\/50:focus { --tw-ring-color: rgba(255, 255, 255, 0.5) !important; }
                .category-button { background-color: rgba(255, 255, 255, 0.2) !important; color: white !important; border: 1px solid rgba(255, 255, 255, 0.1) !important; }
                .category-button:hover { background-color: rgba(255, 255, 255, 0.3) !important; }
                .category-button.selected { background-image: linear-gradient(to right, #a855f7, #ec4899) !important; color: white !important; border-color: transparent !important; }
                .category-button .lucide { color: white !important; display: none; }
                .category-button .emoji-icon { color: white !important; }
                #app-title { background-image: linear-gradient(to right, #22d3ee, #c084fc) !important; }
                #choose-style-title, #your-prompt-title { color: white !important; }
                #lang-en, #lang-tr { color: #bfdbfe !important; }
                #lang-en.active, #lang-tr.active { background-color: rgba(255, 255, 255, 0.3) !important; color: white !important; }
                .theme-toggle-container i { color: #bfdbfe !important; }
                .theme-toggle-container button { color: #bfdbfe !important; }
                .theme-toggle-container button.active { background-color: rgba(255, 255, 255, 0.3) !important; color: white !important; }
                .absolute.top-4.right-4 i { color: #93c5fd !important; }
            `
        };

        const setTheme = (theme) => {
            appState.theme = theme;
            themeStyleElement.textContent = themeStyles[theme];
            if (theme === THEMES.LIGHT) {
                themeLightButton.classList.add('active', 'bg-white/30', 'text-white', 'shadow-md');
                themeLightButton.classList.remove('bg-transparent', 'text-blue-200', 'hover:bg-white/10');
                themeDarkButton.classList.remove('active', 'bg-white/30', 'text-white', 'shadow-md');
                themeDarkButton.classList.add('bg-transparent', 'text-blue-200', 'hover:bg-white/10');
            } else {
                themeDarkButton.classList.add('active', 'bg-white/30', 'text-white', 'shadow-md');
                themeDarkButton.classList.remove('bg-transparent', 'text-blue-200', 'hover:bg-white/10');
                themeLightButton.classList.remove('active', 'bg-white/30', 'text-white', 'shadow-md');
                themeLightButton.classList.add('bg-transparent', 'text-blue-200', 'hover:bg-white/10');
            }
            localStorage.setItem('theme', theme);
            // Update button titles based on theme and language
            updateButtonTitles();
        };

        // --- Language Switching Logic ---
        const setLanguage = (lang) => {
            appState.language = lang;
            document.documentElement.lang = lang;
            // Update UI text
            document.getElementById('app-title').textContent = uiText[lang].appTitle;
            document.getElementById('app-subtitle').textContent = uiText[lang].appSubtitle;
            document.getElementById('choose-style-title').textContent = uiText[lang].chooseStyleTitle;
            document.getElementById('generate-button-text').textContent = uiText[lang].generateButtonText;
            generateButton.setAttribute('aria-label', uiText[lang].generateButtonText);
            document.getElementById('your-prompt-title').textContent = uiText[lang].yourPromptTitle;
            copyButton.title = uiText[lang].copyButtonTitle;
            copyButton.setAttribute('aria-label', uiText[lang].copyButtonTitle);
            downloadButton.title = uiText[lang].downloadButtonTitle;
            downloadButton.setAttribute('aria-label', uiText[lang].downloadButtonTitle);
            copySuccessMessage.textContent = uiText[lang].copySuccessMessage;
            document.getElementById('app-stats').textContent = uiText[lang].appStats;
            document.getElementById('footer-prompter').textContent = uiText[lang].footerPrompter;

            // Update category button text
            categories.forEach(category => {
                const button = document.getElementById(`category-${category.id}`);
                if (button) {
                    const labelSpan = button.querySelector('.category-label');
                    if (labelSpan) {
                        labelSpan.textContent = category.name[lang];
                    }
                    button.setAttribute('aria-label', `${category.name[lang]} category`);
                }
            });

            // Update language button styles
            if (lang === 'en') {
                langEnButton.classList.add('active', 'bg-white/30', 'text-white', 'shadow-md');
                langEnButton.classList.remove('bg-transparent', 'text-blue-200', 'hover:bg-white/10');
                langTrButton.classList.remove('active', 'bg-white/30', 'text-white', 'shadow-md');
                langTrButton.classList.add('bg-transparent', 'text-blue-200', 'hover:bg-white/10');
            } else {
                langTrButton.classList.add('active', 'bg-white/30', 'text-white', 'shadow-md');
                langTrButton.classList.remove('bg-transparent', 'text-blue-200', 'hover:bg-white/10');
                langEnButton.classList.remove('active', 'bg-white/30', 'text-white', 'shadow-md');
                langEnButton.classList.add('bg-transparent', 'text-blue-200', 'hover:bg-white/10');
            }
            localStorage.setItem('language', lang);
            // Update theme button titles based on language
            updateButtonTitles();
        };

       const updateButtonTitles = () => {
             themeLightButton.title = uiText[appState.language].themeLightTitle;
             themeLightButton.setAttribute('aria-label', uiText[appState.language].themeLightTitle);
             themeDarkButton.title = uiText[appState.language].themeDarkTitle;
             themeDarkButton.setAttribute('aria-label', uiText[appState.language].themeDarkTitle);
       };

        // --- Prompt Generation Logic ---
        const generatePrompt = () => {
            appState.isGenerating = true;
            generateButton.disabled = true;
            generatedPromptText.innerHTML = '<div class="flex justify-center items-center h-20"><i data-lucide="loader-2" class="w-6 h-6 animate-spin" aria-hidden="true"></i></div>';
            if (window.lucide && typeof window.lucide.createIcons === 'function') {
                window.lucide.createIcons();
            }
            promptDisplayArea.classList.remove('hidden');
            promptDisplayArea.classList.add('animate-fadeIn');

            setTimeout(() => {
                let categoryData;
                let selectedCatId = appState.selectedCategory;

                if (selectedCatId === 'random') {
                    // Exclude 'random' itself from random selection
                    const availableCategories = categories.filter(c => c.id !== 'random');
                    selectedCatId = availableCategories[Math.floor(Math.random() * availableCategories.length)].id;
                }

                categoryData = prompts[appState.language][selectedCatId];

                if (!categoryData || !categoryData.parts || !Array.isArray(categoryData.parts)) {
                    console.error(`Invalid data for category: ${selectedCatId}, language: ${appState.language}`);
                    generatedPromptText.textContent = 'Error generating prompt. Please try again.';
                    appState.isGenerating = false;
                    generateButton.disabled = false;
                    return;
                }


                const promptParts = categoryData.parts.map((partArray, idx) => {
                    if (!appState.partHistory[idx]) {
                        appState.partHistory[idx] = [];
                    }
                    if (!appState.history[idx]) {
                        appState.history[idx] = [];
                    }
                    const element = getRandomElement(partArray, appState.partHistory[idx]);
                    appState.partHistory[idx].push(element);
                    if (appState.partHistory[idx].length > appState.HISTORY_SIZE) {
                        appState.partHistory[idx].shift();
                    }
                    return element;
                });
                const newPrompt = categoryData.structure
                    ? categoryData.structure(promptParts)
                    : promptParts.join(' ');

                // Update history for each part (FIFO queue)
                promptParts.forEach((part, idx) => {
                    if (!appState.history[idx]) {
                        appState.history[idx] = [];
                    }
                    const hist = appState.history[idx];
                    hist.push(part);
                    if (hist.length > appState.HISTORY_SIZE) {
                        hist.shift();
                    }
                });

                appState.generatedPrompt = newPrompt;
                generatedPromptText.textContent = newPrompt;
                appState.isGenerating = false;
                generateButton.disabled = false;
            }, 300); // Simulate generation time
        };

        // --- Event Listeners ---
        const setupEventListeners = () => {
            // Category buttons
            categories.forEach(category => {
                const button = document.getElementById(`category-${category.id}`);
                if (button) {
                    button.addEventListener('click', () => {
                        appState.selectedCategory = category.id;
                        document.querySelectorAll('.category-button').forEach(btn => btn.classList.remove('selected'));
                        button.classList.add('selected');
                    });
                }
            });

            // Generate button
            generateButton.addEventListener('click', generatePrompt);

            // Copy button
            copyButton.addEventListener('click', () => {
                if (!appState.generatedPrompt) return;
                navigator.clipboard.writeText(appState.generatedPrompt).then(() => {
                    appState.copySuccess = true;
                    copySuccessMessage.classList.remove('hidden');
                    setTimeout(() => {
                        copySuccessMessage.classList.add('hidden');
                        appState.copySuccess = false;
                    }, 2000);
                }).catch(err => {
                    console.error('Failed to copy text: ', err);
                    alert('Failed to copy prompt. Please try again.');
                });
            });

            // Download button
            downloadButton.addEventListener('click', () => {
                if (!appState.generatedPrompt) return;
                const blob = new Blob([appState.generatedPrompt], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `prompt_${appState.selectedCategory}_${Date.now()}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });

            // Language buttons
            langEnButton.addEventListener('click', () => setLanguage('en'));
            langTrButton.addEventListener('click', () => setLanguage('tr'));

            // Theme buttons
            themeLightButton.addEventListener('click', () => setTheme(THEMES.LIGHT));
            themeDarkButton.addEventListener('click', () => setTheme(THEMES.DARK));
        };

        // --- Initialization ---
        const initializeApp = () => {
            const runLucide = () => {
                if (window.lucide && typeof window.lucide.createIcons === 'function') {
                    window.lucide.createIcons();
                    document.querySelectorAll('.emoji-icon').forEach(el => el.classList.add('hidden'));
                    document.querySelectorAll('.category-button .lucide').forEach(el => el.style.display = 'block');
                    return true;
                }
                return false;
            };

            // Load saved language or default to 'en'
            const savedLanguage = localStorage.getItem('language') || 'en';
            setLanguage(savedLanguage);

            // Load saved theme or default to 'dark'
            const savedTheme = localStorage.getItem('theme') || THEMES.DARK;
            setTheme(savedTheme);

            const hasLucide = runLucide();

            categoryButtonsContainer.innerHTML = '';
            categories.forEach(category => {
                const button = document.createElement('button');
                button.id = `category-${category.id}`;
                button.className = 'category-button';
                button.setAttribute('aria-label', `${category.name[appState.language]} category`);
                if (category.id === appState.selectedCategory) {
                    button.classList.add('selected');
                }
                button.innerHTML = `\
                    <span class="emoji-icon mr-1" aria-hidden="true">${category.emoji}</span>\
                    <i data-lucide="${category.icon}" class="lucide" aria-hidden="true"></i>\
                    <span class="category-label">${category.name[appState.language]}</span>`;
                categoryButtonsContainer.appendChild(button);
            });
            runLucide();

            if (!hasLucide && window.lucideScripts) {
                const { cdn, local } = window.lucideScripts;
                [cdn, local].forEach(script => {
                    script && script.addEventListener('load', runLucide, { once: true });
                });
            }

            // Setup event listeners
            setupEventListeners();
        };

        // --- Run Initialization ---
        document.addEventListener('DOMContentLoaded', initializeApp);

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(console.error);
            });
        }

    </script>
</body>
</html>

